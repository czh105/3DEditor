<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <title>用户登录</title>
    <meta name="description" content="particles.js is a lightweight JavaScript library for creating particles." />
    <meta name="author" content="Vincent Garreau" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="../stylesheets/login.css" />   
    <script src="../javascripts/assets/jquery-1.10.2.js"></script>
</head>
<body>
    <div class="login-table">
        <form action="http://127.0.0.1:8080/registerIn" method="post" onsubmit=" return check()" >
            <div class="login-title">注册界面</div>
            <div>
                <div class="login-div">
                    <img src="../images/picture/name.png" alt="error" class="login-img" />
                    <input type="tel" name="user_id" placeholder="账号" style="height: 25px;margin-left:5px;" οnkeyup="value=value.replace(/[^\d]/g,'') " onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[^\d]/g,''))" autofocus="autofocus" />
                    
                </div>
                <div class="login-div">
                    <img src="../images/picture/password.png" alt="error" class="login-img" />
                    <input type="password" name="first_pwd" placeholder="密码" οnkeyup="value=value.replace(/[\W]/g,'') " onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[^\d]/g,''))" style="height: 25px;margin-left:5px;" />
                </div>
                <div class="login-div">
                    <img src="../images/picture/password.png" alt="error" class="login-img" />
                    <input type="password" name="second_pwd" placeholder="再次输入密码" οnkeyup="value=value.replace(/[\W]/g,'') " onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[^\d]/g,''))" style="height: 25px;margin-left:5px;" v-on:input="" />
                </div>
                <div class="login-div">
                    <input type="submit" value="注册" class="login-submit" />
                    <input type="button" value="取消" class="login-for-pwd" />
                </div>
            </div>
        </form>
        <p id="prompt_tag_id" style="display:none;color:red"></p>
    </div>
    <script> 
        //判断是否输入为空
        function check() {
            var user_id = $("input[name='user_id']").val();
            var user_pwd = $("input[name='first_pwd']").val();
            var user_second = $("input[name='second_pwd']").val();
            if (user_id == '' || user_id.length == 0) {
                return false;
            }
            else if (user_id.length == 11 && user_pwd.length >= 6 && user_pwd.length <= 13 && user_pwd == user_second) {
                return true;
            }
        }
        //判断输入账号是否正确
        $("input[name='user_id']").focus(function () {
            $(this).css('background-color', 'white');
            if ($("#prompt_tag_id").not(":hidden")) {
                $("#prompt_tag_id").css("display", "none");
                $("#prompt_tag_id").text('');
            }
        });
        //账号输入实时监听
        $("input[name='user_id']").on("input propertychang", function (evt) {
            let user_id = $(this).val();
            if (user_id.length == 11) {
                //判断该账号是否能够注册
                    $.ajax({
                        type: "post",
                        url: 'http://127.0.0.1:8080/isUserId',
                        data: { userid: user_id },
                        success: function (data) {
                            console.log("isUserId:" + data);
                            if (data == 'false') {
                                $("#prompt_tag_id").text("该账号已经注册！");
                                $("#prompt_tag_id").css("display", 'block');
                            }
                            else {
                                $("#prompt_tag_id").text("该账号可以注册注册！");
                                $("#prompt_tag_id").css("display", 'block');
                                $("#prompt_tag_id").css("color", "black");
                                $("input[name='first_pwd']").focus();
                            }
                        },
                        error: function (err) {
                            console.error(err);
                        },
                    });
               
            }
        });
        //判断输入是否是电话号码,焦点
        $("input[name='user_id']").blur(function () {       
            let user_id = $(this).val();
            if(!(/^1(3|4|5|6|7|8|9)\d{9}$/.test(user_id)) && user_id.length < 11){ 
                //alert("手机号码有误，请重填");  
                $(this).css('background-color','red');
            }
            else{
                $(this).css('background-color','white');
            }
        });  
        //判断两个密码是否相同
        $("input[name='first_pwd']").on("input propertychang", function (evt) {
            var user_pwd = $(this).val();
            if (user_pwd.length <= 0) {

                $("#prompt_tag_id").hide();
            }
            else {
                if (user_pwd.length >= 8 && user_pwd.length < 16) {
                    $("#prompt_tag_id").text("密码OK");
                }
                else if (user_pwd.length == 16) {
                    $("#prompt_tag_id").text("密码已达到最大长度");
                } else if (user_pwd.length > 0) {
                    $("#prompt_tag_id").text("密码长度小于8位");
                }
                $("#prompt_tag_id").show();
            }
        });
            
        //判断第一次密码输入实时监控
        $("input[name='second_pwd']").on("input propertychang",function (evt) {
            console.log("再次输入密码监听");
            let first_pwd = $("input[name='first_pwd']").val();
            let second_pwd = $("input[name='second_pwd']").val();
            if (first_pwd == second_pwd) {
                /*$('#prompt_tag').text('两次密码不同');
                $("#prompt_tag").css("display", 'block');*/
                $("input[name='second_pwd']").blur();
            }
        });
    </script>
</body>
</html>